<div class="instruction_plan">
    <div class="row">
        <!--点击路线模态框-->
        <div id="carInfoModel" class="modal modal-fixed-footer" style="width: 72%">
            <div class="modal-content center fz20" style="font-weight: 500;padding: 0">
                <div class="row col s12 vc-center" style="font-weight: bold;height: 80px;background-color:rgb(63,185,193)">
                    <div class="col s3 fz22 white-text" style="font-weight: 600">
                        <p>{{currentModelInfo.date_id}}</p>
                    </div>
                    <div class="col s6 vc-center">
                        <h6 class="white-text fz22" style="font-weight:600">{{currentModelInfo.city_route_start}}&emsp;<span style="font-size: 1.7rem" class="mdi mdi-arrow-right"></span><span>&emsp;{{currentModelInfo.city_route_end}}</span></h6>
                    </div>
                    <div class="col s3 fz22 white-text" style="font-weight: 600">
                        <p>{{currentDistance == "notSet" ? "里程未设置" : currentDistance + " 公里"}}</p>
                    </div>
                </div>
                <div class="row col s12 vc-center">
                    <div class="col s6">
                        <p>发运车商品总数：<span style="color: rgb(63,185,193);font-size: 1.8rem">{{currentModelInfo.pre_count}}</span> 辆</p>
                    </div>
                    <div class="col s6">
                        <p>未派发商品车数：<span style="color: rgb(229,115,115);font-size: 1.8rem">{{currentModelInfo.pre_count - currentModelInfo.plan_count}}</span> 辆</p>
                    </div>
                </div>
                <!--模态框内信息卡片-->
                <div class="row col s12">
                    <div class="col s4" ng-repeat="transport in transportationList">
                        <div class="card-panel white " style="padding: 0">
                            <div class="row white-text setting_shipments_title vc-center" ng-class="{'dis_bgc':transport.demand_status != 1}"
                                 style="padding: 8px;height: 50px;margin-bottom: 12px;background-color:rgb(77,208,225);">
                                <div class="col s12 center fz17">
                                    <p><span >{{transport.addr_name}}</span>&emsp;<span class="mdi mdi-arrow-right"></span>&emsp;<span>{{transport.short_name}}</span></p>
                                </div>
                            </div>
                            <div class="row fz15" ng-class="{'dis_txt':transport.demand_status != 1}">
                                <div class="col s7" style="margin-bottom: 12px" >
                                    <p>共发运商品车：<span style="color: rgb(229,115,115)" ng-class="{'dis_txt':transport.demand_status != 1}">{{transport.pre_count}}</span>&nbsp;辆</p>
                                </div>
                                <div class="col s5" style="margin-bottom: 12px">
                                    <p>已派发：<span style="color: rgb(229,115,115)" ng-class="{'dis_txt':transport.demand_status != 1}">{{transport.plan_count}}</span>&nbsp;辆</p>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer vc-center">
                <button ng-click="closeModel()" class="btn waves-light waves-effect cyan lighten-1" type="button" style="margin-left: 56px" >
                    确定
                </button>
            </div>
        </div>

        <!--左栏发运商品车信息卡片-->
        <div class="row col s2">
            <div class="col input-field s10" style="margin-bottom: 15px">
                <input id="searchLeftCard" type="text" ng-model="leftKeyWord">
                <label for="searchLeftCard">起始地/目的地</label>
            </div>
            <div class="col s2 flex flex-round">
                <i class="mdi mdi-magnify" ng-click="updateLeftCardList()" style="margin:20px 0 0 10px;font-size: 30px;cursor: pointer"></i>
            </div>
            <div class="col s12" ng-repeat="car in newDispatchCarList">
                <div class="card-panel white " style="padding: 0">
                    <div class="row cyan lighten-2 white-text setting_shipments_title vc-center"
                         style="padding: 10px;height: 42px">
                        <div class="col s12 center" style="padding: 0;">
                            <h6 class="white-text fz16" style="font-weight:bold;margin: 0">{{car.city_route_start}}&emsp;
                                <span style="font-size: 1.2rem" class="mdi mdi-arrow-right"></span>
                                <span>&emsp;{{car.city_route_end}}</span>
                            </h6>
                        </div>

                        <a style="top: 65%;width: 37px;height: 37px;right: 9px"
                           class="right btn-floating setting_shipments_btn  btn waves-effect materialize-red  lighten-2 waves-light vc-center ">
                            <i style="font-size: 1.3rem;line-height: 38px" ng-click="showCarInfoModel(car)"
                               class="mdi mdi-file-document"></i>
                        </a>
                    </div>
                    <div class="row fz14">
                        <div class="col s12 center grey-text">
                            <p style="margin: -5px 0;">{{car.date_id}}</p>
                        </div>
                        <div class="col s6" style="padding-right: 0">
                            <p class="grey-text row center" style="padding: 6px 0 8px 0;margin:0">
                                待发运
                                <span style="font-size: 1.2rem;color:rgb(229,115,115);font-weight: bold">{{car.pre_count}}&nbsp;</span>
                            </p>
                        </div>
                        <div class="col s6" style="padding-left: 0">
                            <p class="grey-text row center" style="padding: 6px 0 8px 0;margin:0">
                                已安排
                                <span style="font-size: 1.2rem;color:rgb(229,115,115);font-weight: bold">{{car.plan_count}}&nbsp;</span>
                            </p>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!--中间调度指令-->
        <div class="col s8">
            <div class="col s12" style="margin-bottom: 11px">
                <h5 class="col s12 cyan-text lighten-1 center-align">
                    调度指令
                </h5>
            </div>
            <div class="row col s12">
                <div class="divider" style="background: #00bcd4;height: 2px"></div>
            </div>
            <!--中间部分信息-->
            <div class="col s12" ng-show="showMiddleCard">
                <!--中间信息卡片-->
                <div class="col s12" style="margin-top: -5px">
                    <div class="card-panel white" style="padding: 0">
                        <div class="row cyan lighten-2 white-text setting_shipments_title vc-center"
                             style="padding: 10px;height: 60px;margin-bottom: 6px">
                            <div class="col s1">
                                <span style="font-size: 2.2rem" class="mdi mdi-truck"></span>
                            </div>
                            <div class="col s3">
                                <p style="font-size: 1.2rem;font-weight: bold;margin: 10px 0">{{dispatchInfo.truck_num}}</p>
                            </div>
                            <div class="col s2">
                                <p style="font-size: 1rem;font-weight: bold;margin: 10px 0">{{dispatchInfo.operate_status}}</p>
                            </div>
                            <div class="col s1 right-align">
                                <span style="font-size: 1.6rem;color: white" class="mdi mdi-map-marker"></span>
                            </div>
                            <div ng-if="!dispatchInfo.city_name == 0" class="col s2 left-align">
                                <p style="font-size: 1.1rem;color: white;margin: 5px 0;line-height: 26px">{{dispatchInfo.city_name}}</p>
                            </div>
                            <div ng-if="dispatchInfo.city_name == 0" class="col s2 left-align">
                                <p>{{dispatchInfo.task_start_name}}
                                    <span class="mdi mdi-arrow-right"></span>
                                    {{dispatchInfo.task_end_name}}
                                </p>
                            </div>
                            <div class="col s1 right-align">
                                <span style="font-size: 1.6rem;color: white" class="mdi mdi-account"></span>
                            </div>
                            <div class="col s2 left-align">
                                <p style="font-size: 1.1rem;color: white;margin: 5px 0;line-height: 26px">{{dispatchInfo.drive_name}}</p>
                            </div>
                        </div>
                        <div class="row fz15">
                            <div class="col s4">
                                <p>所属公司：{{dispatchInfo.company_name}}</p>
                            </div>
                            <div class="col s2">
                                <p>车位：{{dispatchInfo.trail_number}}</p>
                            </div>
                            <div class="col s3">
                                <p>已使用车位：{{dispatchInfo.car_count}}</p>
                            </div>
                            <div class="col s3">
                                <p>电话：{{dispatchInfo.truck_tel}}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!--往期任务-->
                <div class="col s12 black-text left-align fz18">
                    <p style="margin: 10px 0">往期任务</p>
                    <div class="divider black lighten-2"></div>
                </div>
                <div class="col s12 black-text fz14" ng-repeat="mission in pastMissionList">
                    <div class="col s4 center-align">
                        <p>{{mission.task_start_date | date:'yyyy-MM-dd'}}&nbsp;&nbsp;<span class="mdi mdi-arrow-right"></span>&nbsp;&nbsp;{{mission.date_id}}</p>
                    </div>
                    <div class="col s4 center-align">
                        <p>{{mission.city_route_start}}&nbsp;&nbsp;<span class="mdi mdi-arrow-right"></span>&nbsp;&nbsp;{{mission.city_route_end}}&emsp;{{mission.distance}} 公里</p>
                    </div>
                    <div class="col s4 center-align">
                        <p>派发商品车：{{mission.car_count}} 辆&emsp;已完成</p>
                    </div>
                </div>

                <!--当前任务-->
                <div class="col s12" style="margin-top: 20px">
                    <div class="col s8 black-text left-align fz18" style="padding: 0;">
                        <p style="margin: 10px 0">当前任务</p>
                    </div>
                    <div class="col s4 right-align">
                        <button ng-click="showCreateLine(dispatchInfo.current_city)" style="padding: 0 35px;height: 30px;line-height: 33px;margin-top: 10px" class="btn waves-light waves-effect cyan lighten-1 fz12" type="button">
                            生成线路
                        </button>
                    </div>
                    <div class="col s12 black-text left-align fz18" style="padding: 0;">
                        <div class="divider black lighten-2"></div>
                    </div>
                </div>

                <!--生成线路-->
                <div class="col s12 black-text fz14 center-align" style="margin-top: 15px" ng-show="lineInfo">
                    <div class="col s4 center-align">
                        <div class="col s4 center-align" style="padding: 0">
                            <p>{{startCityName}}&emsp;&emsp;<span class="mdi mdi-arrow-right"></span></p>
                        </div>
                        <div class="col s8">
                            <select id="city" name="city" watch material-select
                                    ng-options="city.city_name + ' ' + city.distance + ' km' for city in cityList"
                                    ng-model="lineEndCityInfo">
                                <option value="">选择城市</option>
                            </select>
                        </div>
                    </div>
                    <div class="col s5">
                        <div class="col s5 right-align">
                            <p>计划执行时间：</p>
                        </div>
                        <div class="col s7" style="padding: 0">
                            <div class="col s7 input-field" style="margin: 0;padding: 0">
                                <input id="verification_time2" type="text" class="datepicker" ng-model="lineStartDate" date>
                                <i class="mdi dataIcon mdi-table-large"></i>
                                <label for="verification_time2">指令时间</label>
                            </div>
                        </div>

                    </div>
                    <div class="col s3">
                        <div class="col s6" style="padding: 10px 5px">
                            <button style="padding:0;width:100%;height: 30px;line-height: 33px" class="btn waves-light waves-effect red lighten-1 fz12" ng-click="hideLineInfo()" type="button">
                                取消
                            </button>
                        </div>
                        <div class="col s6 right-align" style="padding: 10px 5px">
                            <button ng-click="confirmChange()" style="padding:0;width:100%;height: 30px;line-height: 33px" class="btn waves-light waves-effect cyan lighten-1 fz12" type="button">
                                确认
                            </button>
                        </div>
                    </div>
                </div>

                <div class="col s12 black-text fz14 center-align" style="margin-top: 15px">
                    <ul class="collapsible" data-collapsible="accordion" style="overflow: hidden">
                        <li ng-repeat="currentLine in currentLineList">
                            <!--线路列表-->
                            <div class="collapsible-header col s12 valign-wrapper collapsible_height" ng-click="showMissionInfo(currentLine.id,currentLine.task_plan_date,currentLine.route_start_id)">
                                <div class="col s9">
                                    <div class="col s6 center-align">
                                        <div class="col s4 center-align" style="padding: 0">
                                            <p>{{currentLine.city_route_start}}&emsp;&emsp;<span class="mdi mdi-arrow-right"></span></p>
                                        </div>
                                        <div class="col s8 left-align">
                                            <p>{{currentLine.city_route_end}}</p>
                                        </div>
                                    </div>
                                    <div class="col s6">
                                        <div class="col s6" style="padding: 0">
                                            <p>计划执行时间：</p>
                                        </div>
                                        <div class="col s6 left-align" style="padding: 0">
                                            <p>{{currentLine.task_plan_date | date:'yyyy-MM-dd'}}</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="col s3">
                                    <div class="col s6 right" style="padding: 0 5px">
                                        <button style="padding:0;width:100%;height: 30px;line-height: 33px" class="btn waves-light waves-effect red lighten-1 fz12" ng-click="deleteLine(currentLine.id,$event)" type="button">
                                            删除线路
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!--拉开的任务列表栏,显示任务-->
                            <div class="collapsible-body" style="padding: 0">
                                <!--增加任务-->
                                <div class="row col s12" ng-show="addMissionBtn">
                                    <div class="col s3 right-align right" style="padding:15px 0">
                                        <button ng-click="addMission()" style="width:100%;height: 30px;line-height: 33px"
                                                class="btn waves-light waves-effect cyan lighten-1 fz12" type="button">
                                            增加任务
                                        </button>
                                    </div>
                                </div>
                                <div class="col s12 black-text fz14 center-align" style="margin-top: 15px;height: 205px" ng-show="missionInfo">
                                    <div class="col s4 valign-wrapper">
                                        <div class="col s5">
                                            <select id="chooseLocate" name="chooseLocate" ng-model="$parent.locateId" watch material-select>
                                                <option value="" selected>装车地点</option>
                                                <option ng-repeat="locateCity in locateList" ng-value="locateCity.id">{{locateCity.addr_name}}</option>
                                            </select>
                                        </div>
                                        <div class="col s2">
                                            <span class="mdi mdi-arrow-right"></span>
                                        </div>
                                        <div class="col s5">
                                            <select id="chooseCity" name="chooseCity" ng-change="getReceiveDistributor(currentLine.id)" ng-model="$parent.sendCityId" watch material-select>
                                                <option value="">选择城市</option>
                                                <option ng-repeat="sendCity in sendCityList" ng-value="sendCity.id">{{sendCity.city_name}}</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col s4 valign-wrapper">
                                        <div class="col s12">
                                            <select id="chooseDistributor" name="chooseDistributor" ng-options="addr.date_id + ' ' + addr.short_name + ' ' + addr.pre_count + '台 ' for addr in addrList" ng-model="$parent.receiveInfo" watch material-select>
                                                <option value="">送达经销商</option>
                                                <!--<option ng-repeat="addr in addrList" ng-value="addr.id">{{addr.short_name}}</option>-->
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col s1 right-align">
                                        <p>数量：</p>
                                    </div>
                                    <div class="col s1">
                                        <input type="number" ng-model="$parent.distributeNum">
                                    </div>
                                    <div class="col s2">
                                        <div class="col s6 right-align">
                                            <a class="modal-action modal-close waves-light waves-effect red lighten-1 btn btn-floating" ng-click="closeMissionInfo()">
                                                <i class="mdi mdi-close"></i>
                                            </a>
                                        </div>
                                        <div class="col s6 left-align">
                                            <a class="modal-action modal-close waves-light waves-effect cyan lighten-1 btn btn-floating" ng-click="submitMissionInfo(currentLine.id)">
                                                <i class="mdi mdi-check"></i>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="col s12">
                                        <div class="col s3 right-align">
                                            <p>计划执行时间：</p>
                                        </div>
                                        <!--<div class="col s7" style="padding: 0">-->
                                            <div class="col s3 input-field" style="margin: 0">
                                                <input placeholder="" id="verification_time4" type="text" class="datepicker"
                                                       ng-model="$parent.lineDate" date>
                                                <i class="mdi dataIcon mdi-table-large"></i>
                                                <label for="verification_time4" class="active">指令时间</label>
                                            </div>
                                            <div class="col s1"></div>
                                            <div class="col s3 input-field" style="margin: 0">
                                                <input id="verification_time3" type="text" class="timepicker" ng-model="$parent.lineStartTime" time>
                                                <i class="mdi dataIcon mdi-clock"></i>
                                                <label for="verification_time3">时/分</label>
                                            </div>
                                        <!--</div>-->
                                    </div>
                                </div>
                                <!--任务列表-->
                                <div class="col s12 valign-wrapper" ng-repeat="nowMission in missionList" style="border-top: 1px solid #ccc">
                                    <div class="col s3" style="padding: 0">
                                        <div class="col s6 right-align" style="padding: 0">
                                            <p>{{nowMission.addr_name}}&emsp;<span class="mdi mdi-arrow-right"></span></p>
                                        </div>
                                        <div class="col s6 left-align">
                                            <p>{{nowMission.city_name}}&emsp;{{ "(" + nowMission.short_name + ")"}}</p>
                                        </div>
                                    </div>
                                    <!--<div class="col s4">-->
                                        <!--<p>{{"(" + nowMission.short_name + ")"}}</p>-->
                                    <!--</div>-->
                                    <div class="col s3">
                                        <p>{{nowMission.plan_date | date:'yyyy-MM-dd - HH:mm'}}</p>
                                    </div>
                                    <div class="col s3">
                                        <p>数量：{{nowMission.plan_count}}</p>
                                    </div>
                                    <div class="col s2">
                                        <a ng-click="deleteMission(nowMission.id,currentLine.id)" style="width: 30px;height: 30px" class="modal-action modal-close waves-light waves-effect red lighten-1 btn btn-floating">
                                            <i style="line-height: 30px" class="mdi mdi-close"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>

            </div>

        </div>

        <!--右边任务指令信息卡片-->
        <div class="col s2">
            <div class="col input-field s10" style="margin-bottom: 15px">
                <input id="searchRightCard" type="text" ng-model="rightKeyWord">
                <label for="searchRightCard">车牌/地址/司机</label>
            </div>
            <div class="col s2 flex flex-round">
                <i class="mdi mdi-magnify" ng-click="updateRightCardList()" style="margin:20px 0 0 10px;font-size: 30px;cursor: pointer"></i>
            </div>
            <div class="col s12" ng-repeat="details in newCarDetailsList">
                <div class="card-panel white " style="padding: 0;cursor: pointer" ng-click="showDispatchInfo(details)">
                    <div class="row cyan lighten-2 white-text setting_shipments_title vc-center"
                         style="padding: 8px 5px;height: 43px;margin-bottom: 0">
                        <!--<div class="col s2 center">-->
                            <!--<span style="font-size: 1.6rem" class="mdi mdi-truck"></span>-->
                        <!--</div>-->
                        <div class="col s7">
                            <p style="font-size: 1rem;font-weight: bold;margin: 10px 0">{{details.truck_num}}</p>
                        </div>
                        <div class="col s5" style="padding: 0;">
                            <p style="font-size: 1rem;font-weight: bold;margin: 10px 0">{{details.operate_status}}</p>
                        </div>
                    </div>
                    <div class="row valign-wrapper">
                        <div class="col s9" style="padding: 0">
                            <div class="col s12 valign-wrapper" style="padding: 0">
                                <div class="col s3 vc-center">
                                    <span style="font-size: 1.3rem;color: darkgray" class="mdi mdi-map-marker"></span>
                                </div>
                                <div ng-if="!details.current_city == 0" class="col s9 left" style="padding: 0;">
                                    <p style="font-size: 1.0rem;color: black;margin: 5px 0;line-height: 26px">{{details.city_name}}</p>
                                </div>
                                <div ng-if="details.current_city == 0" class="col s9 left" style="padding: 0;">
                                    <p>{{details.task_start_name}}
                                       <span class="mdi mdi-arrow-right"></span>
                                        {{details.task_end_name}}
                                    </p>
                                </div>
                            </div>
                            <div class="col s12 valign-wrapper" style="margin-bottom: 0;padding: 0">
                                <div class="col s3 vc-center">
                                    <span style="font-size: 1.3rem;color: darkgray" class="mdi mdi-account"></span>
                                </div>
                                <div class="col s9 left fz12" style="padding: 0;">
                                    <p style="color: black;margin: 5px 0;line-height: 26px">{{details.drive_name}}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col s3" style="padding: 0">
                            <div class="col s12">
                                <p class="center fz19" style="color: rgb(229,115,115);font-weight: bold;margin: 0">{{details.car_count}}</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>